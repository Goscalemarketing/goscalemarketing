<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AR</title>

  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    html,body{margin:0;height:100%;background:#000;}
    #btn{
      position:fixed; left:16px; right:16px; bottom:16px;
      padding:16px; border-radius:14px; border:0;
      font:800 16px system-ui; background:#fff; color:#000;
      z-index:10;
    }
    model-viewer{width:100%;height:100%;background:#000;}
  </style>
</head>

<body>

<model-viewer
  id="mv"
  ar
  ar-modes="webxr"
  camera-controls
  autoplay

  /* ✅ Mejora “apagado” en Android (sin tocar modelado) */
  exposure="1.35"
  tone-mapping="aces"
  shadow-intensity="0.6"

  /* ✅ Fondo/iluminación agradable (HDRI ligero) */
  environment-image="https://modelviewer.dev/shared-assets/environments/neutral.hdr">
</model-viewer>

<button id="btn">Abrir AR</button>

<script>
  // ✅ Usa tu WORKER (para evitar CORS)
  const GLB_URL  = "https://cucharavieja-ar.rough-meadow-c2c6.workers.dev/Restaurante_Cuchara_Vieja/Pastel_Banana_Chip/pastelbananachip.glb";
  const USDZ_URL = "https://cucharavieja-ar.rough-meadow-c2c6.workers.dev/Restaurante_Cuchara_Vieja/Pastel_Banana_Chip/pastelbananachip.usdz";

  const ua = navigator.userAgent;
  const isiOS = /iPhone|iPad|iPod/i.test(ua);
  const isAndroid = /Android/i.test(ua);

  const mv = document.getElementById("mv");
  mv.src = GLB_URL;

  document.getElementById("btn").onclick = async () => {
    if (isiOS) {
      // iOS: Quick Look
      window.location.href = USDZ_URL;
      return;
    }

    if (isAndroid) {
      // Android: WebXR (model-viewer)
      try {
        await mv.activateAR();
      } catch (e) {
        alert("No se pudo abrir AR. Prueba desde Chrome y revisa Google Play Services for AR (ARCore).");
      }
      return;
    }

    // Otros: abre el modelo
    window.location.href = GLB_URL;
  };
</script>

</body>
</html>
