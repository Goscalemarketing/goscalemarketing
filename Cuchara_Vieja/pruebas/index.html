<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pastel Banana Chip AR</title>

<!-- Model Viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
:root{
  --bg:#0b0b0b;
  --text:#ffffff;
  --muted:#cfcfcf;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
}

.wrap{
  max-width:520px;
  margin:0 auto;
  padding:18px 16px 0;
}

/* TOP BAR */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.back{
  border:1px solid rgba(255,255,255,.2);
  border-radius:14px;
  padding:10px 14px;
  color:#fff;
  text-decoration:none;
  font-size:14px;
}

.by{
  display:flex;
  align-items:center;
  gap:8px;
  text-decoration:none;
  color:#fff;
  border:1px solid rgba(255,255,255,.2);
  border-radius:14px;
  padding:8px 12px;
}

.by img{
  height:26px;
}

/* TITLE */
h1{
  font-size:28px;
  font-weight:800;
  margin:14px 0 6px;
}

.desc{
  color:var(--muted);
  font-size:15px;
  line-height:1.45;
}

/* VIEWER */
.viewerWrap{
  margin:20px 0 10px;
}

model-viewer{
  width:100%;
  height:340px;
  background:#000;
  border-radius:18px;
}

/* AR BUTTON */
.arBtn{
  width:100%;
  margin-top:14px;
  padding:16px;
  font-size:17px;
  font-weight:800;
  border-radius:18px;
  border:0;
  cursor:pointer;
  background:#fff;
  color:#000;
}

/* RESTAURANT LOGO BOTTOM */
.brandBottom{
  display:flex;
  justify-content:center;
  padding:32px 16px 44px;
  margin-top:16px;
  background:linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,0));
}

.restaurantLogo{
  height:120px;
  width:auto;
  max-width:95%;
  filter: drop-shadow(0 6px 16px rgba(0,0,0,.45));
}

/* LOADER */
#loader{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.loaderBox{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:14px;
}

.spinner{
  width:48px;
  height:48px;
  border:4px solid rgba(255,255,255,.2);
  border-top:4px solid #fff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

.loaderText{
  font-size:14px;
  opacity:.85;
}

@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="wrap">

  <div class="topbar">
    <a class="back" href="https://www.canva.com/design/DAG8SYy2DPc/RVkcbBbMLHthtSRnkiUkGA/view">
      ← Menú
    </a>

    <a class="by" href="https://goscalemarketing.com" target="_blank" rel="noopener">
      by
      <img src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/assets/logo/goscalemarketing-logo.png" alt="GoScale" />
    </a>
  </div>

  <h1>Pastel Banana Chip</h1>
  <p class="desc">
    Ingredientes: banana, harina, azúcar, huevos, mantequilla, chips de chocolate.
  </p>

  <div class="viewerWrap">
    <model-viewer
      id="mv"
      src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/Restaurante_Cuchara_Vieja/Pastel_Banana_Chip/pastelbananachip.glb"
      ios-src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/Restaurante_Cuchara_Vieja/Pastel_Banana_Chip/pastelbananachip.usdz"
      ar
      ar-modes="scene-viewer quick-look webxr"
      camera-controls
      auto-rotate
      exposure="1"
      shadow-intensity="1"
      alt="Pastel Banana Chip AR">
    </model-viewer>

    <button class="arBtn" id="openAR">Ver en AR</button>
  </div>

</div>

<div class="brandBottom">
  <img
    class="restaurantLogo"
    src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/assets/logo/LOGO%20OPC%202_MONOGRAMA%2CLOGOY%20LEMA%20NARANJA-18.png"
    alt="Restaurante"
  />
</div>

<!-- LOADER -->
<div id="loader">
  <div class="loaderBox">
    <div class="spinner"></div>
    <div class="loaderText">Abriendo cámara…</div>
  </div>
</div>

<script>
const mv = document.getElementById("mv");
const btn = document.getElementById("openAR");
const loader = document.getElementById("loader");

// Encender loader y abrir AR
btn.addEventListener("click", async () => {
  loader.style.display = "flex";
  try {
    await mv.activateAR(); // abre Scene Viewer / Quick Look / WebXR según dispositivo
  } catch (e) {
    // si el navegador bloquea o falla, quitamos loader
    loader.style.display = "none";
  }
});

// ✅ IMPORTANTÍSIMO: al volver de AR, apagar loader SIEMPRE
function hideLoaderOnReturn(){
  loader.style.display = "none";
}

// Vuelve desde apps externas (Scene Viewer) o Quick Look -> estos eventos suelen dispararse
window.addEventListener("pageshow", hideLoaderOnReturn);
window.addEventListener("focus", hideLoaderOnReturn);
document.addEventListener("visibilitychange", () => {
  if (!document.hidden) hideLoaderOnReturn();
});

// Extra: si el usuario cancela o no soporta AR, también apagar loader
mv.addEventListener("ar-status", (ev) => {
  const s = ev.detail.status;
  // statuses típicos: "not-presenting", "session-started", "failed"
  if (s === "not-presenting" || s === "failed") {
    loader.style.display = "none";
  }
});
</script>

</body>
</html>
