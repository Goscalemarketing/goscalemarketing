<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Pastel Banana Chip · AR</title>

  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#0b0b0b; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

    /* Header fijo */
    header{
      position:fixed; inset:0 0 auto 0; height:56px;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 12px;
      background:rgba(15,15,15,.72); backdrop-filter: blur(10px);
      color:#fff; z-index:20;
      gap:10px;
    }
    header .left{ display:flex; align-items:center; gap:10px; min-width:0; }

    a.menuBtn{
      color:#fff; text-decoration:none;
      border:1px solid rgba(255,255,255,.18);
      border-radius:10px;
      padding:8px 10px;
      font-weight:600;
      font-size:14px;
      white-space:nowrap;
    }

    /* “by goscale” arriba derecha */
    a.byGoscale{
      display:flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      color:rgba(255,255,255,.85);
      font-size:12px;
      font-weight:700;
      border:1px solid rgba(255,255,255,.16);
      border-radius:12px;
      padding:8px 10px;
      background:rgba(255,255,255,.06);
      white-space:nowrap;
    }
    a.byGoscale img{
      height:20px; /* más grande que antes */
      width:auto;
      opacity:.95;
    }

    /* Zona principal: dejamos espacio para header */
    main{ position:fixed; inset:56px 0 0 0; display:flex; flex-direction:column; }

    /* Bloque info arriba del viewer */
    #dishInfo{
      padding:14px 16px 10px;
      background:linear-gradient(
        to bottom,
        rgba(11,11,11,.92),
        rgba(11,11,11,.75),
        rgba(11,11,11,0)
      );
      z-index:5;
    }
    #dishTitle{
      margin:0;
      font-size:22px;
      font-weight:900;
      color:#fff;           /* ✅ bien visible */
      letter-spacing:.2px;
      text-shadow: 0 2px 14px rgba(0,0,0,.55);
    }
    #dishDesc{
      margin:8px 0 0;
      font-size:14px;
      line-height:1.35;
      color:rgba(255,255,255,.75);
      max-width:520px;
    }

    /* Contenedor del viewer */
    .viewerWrap{
      position:relative;
      flex:1;
      min-height: 0;
    }
    model-viewer{
      width:100%;
      height:100%;
      background:#0b0b0b;
      display:block;
    }

    /* Botón AR dentro del viewer (arriba derecha sobre el 3D) */
    button.arBtn{
      position:absolute;
      top:12px;
      right:12px;
      border:0;
      border-radius:12px;
      padding:12px 14px;
      font-weight:900;
      background:#fff;
      color:#111;
      cursor:pointer;
      box-shadow:0 10px 26px rgba(0,0,0,.35);
      z-index:10;
    }
    button.arBtn:disabled{ opacity:.55; cursor:not-allowed; }

    /* Logo grande debajo del viewer */
    .brandBottom{
      padding:14px 16px 18px;
      display:flex;
      justify-content:center;
      align-items:center;
      border-top:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.15);
    }
    .brandBottom img{
      height:34px; /* ✅ visible */
      width:auto;
      opacity:.95;
    }
  </style>
</head>

<body>
  <header>
    <div class="left">
      <a class="menuBtn" id="menuLink" href="#" target="_self">← Menú</a>
    </div>

    <!-- ✅ By Goscale (clicable a web) -->
    <a class="byGoscale" href="https://goscalemarketing.com" target="_blank" rel="noopener">
      <span>by</span>
      <img
        src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/assets/logo/goscalemarketing-logo.png"
        alt="GoScaleMarketing"
      />
    </a>
  </header>

  <main>
    <!-- ✅ Info del plato -->
    <section id="dishInfo">
      <h1 id="dishTitle">Pastel Banana Chip</h1>
      <p id="dishDesc">
        Ingredientes: banana, harina, azúcar, huevos, mantequilla, chips de chocolate.
      </p>
    </section>

    <!-- ✅ Viewer + botón AR dentro del viewer -->
    <div class="viewerWrap">
      <button id="arBtn" class="arBtn" disabled>Ver en AR</button>

      <model-viewer
        id="mv"
        src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/Restaurante_Cuchara_Vieja/Pastel_Banana_Chip/pastelbananachip.glb"
        ios-src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/Restaurante_Cuchara_Vieja/Pastel_Banana_Chip/pastelbananachip.usdz"

        camera-controls
        interaction-prompt="none"
        touch-action="pan-y"

        loading="eager"
        reveal="auto"

        environment-image="https://modelviewer.dev/shared-assets/environments/neutral.hdr"
        tone-mapping="neutral"
        exposure="1.6"
        shadow-intensity="1"

        ar
        ar-placement="floor"
        ar-scale="fixed"
        ar-modes="webxr scene-viewer quick-look"
        ar-light-estimation>
      </model-viewer>
    </div>

    <!-- ✅ Logo grande abajo (de momento el vuestro) -->
    <div class="brandBottom">
      <img
        src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/assets/logo/goscalemarketing-logo.png"
        alt="GoScaleMarketing"
      />
    </div>
  </main>

  <script>
    const MENU_URL = "https://www.canva.com/design/DAG8SYy2DPc/RVkcbBbMLHthtSRnkiUkGA/view?utm_content=DAG8SYy2DPc&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h5c7aa53580";

    const mv = document.getElementById('mv');
    const arBtn = document.getElementById('arBtn');
    const menuLink = document.getElementById('menuLink');

    menuLink.href = MENU_URL;

    const ua = navigator.userAgent || '';
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    const isAndroid = /Android/i.test(ua);

    // Look estable del viewer
    const VIEWER = { exposure: 1.6, shadow: 1.0, tone: 'neutral' };
    // Look SOLO para WebXR AR (evita lavado en algunos Android)
    const WEBXR_AR = { exposure: 0.85, shadow: 0.15, tone: 'neutral' };

    function applyViewerLook(){
      mv.toneMapping = VIEWER.tone;
      mv.exposure = VIEWER.exposure;
      mv.shadowIntensity = VIEWER.shadow;
    }
    function applyWebxrArLook(){
      mv.toneMapping = WEBXR_AR.tone;
      mv.exposure = WEBXR_AR.exposure;
      mv.shadowIntensity = WEBXR_AR.shadow;
    }

    async function chooseMode(){
      applyViewerLook();

      if (isIOS) {
        mv.setAttribute('ar-modes', 'quick-look');
        arBtn.disabled = false;
        return;
      }

      if (isAndroid) {
        try {
          const webxrOk = !!(navigator.xr && await navigator.xr.isSessionSupported('immersive-ar'));
          if (webxrOk) {
            mv.setAttribute('ar-modes', 'webxr');
          } else {
            mv.setAttribute('ar-modes', 'scene-viewer');
          }
          arBtn.disabled = false;
          return;
        } catch {
          mv.setAttribute('ar-modes', 'scene-viewer');
          arBtn.disabled = false;
        }
      }
    }

    mv.addEventListener('load', chooseMode);

    arBtn.addEventListener('click', async () => {
      try {
        await mv.activateAR();
      } catch {
        applyViewerLook();
      }
    });

    // WebXR: al entrar/salir, ajusta look (sin redirecciones)
    mv.addEventListener('ar-status', (ev) => {
      if (ev.detail.status === 'session-started') {
        applyWebxrArLook();
      }
      if (ev.detail.status === 'not-presenting') {
        applyViewerLook();
      }
    });
  </script>
</body>
</html>
