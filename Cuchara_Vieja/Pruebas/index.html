<model-viewer
  id="mv"
  src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/Restaurante_Cuchara_Vieja/Pruebas/Pruebas.glb"
  ios-src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/Restaurante_Cuchara_Vieja/Pruebas/Pruebas.usdz"

  camera-controls
  disable-pan
  interaction-prompt="none"
  loading="eager"
  reveal="auto"

  environment-image="https://modelviewer.dev/shared-assets/environments/neutral.hdr"
  tone-mapping="neutral"
  exposure="1.6"
  shadow-intensity="1"

  camera-orbit="0deg 75deg 2.2m"
  min-camera-orbit="-180deg 75deg 0.8m"
  max-camera-orbit="180deg 75deg 2.2m"

  ar
  ar-placement="floor"
  /* Cambiamos auto por fixed para evitar el rebote por cálculo de escala */
  ar-scale="fixed"
  /* Ponemos ambos: si Scene Viewer rebota, WebXR entrará al rescate */
  ar-modes="scene-viewer webxr quick-look"
  ar-light-estimation
>
  <button id="arBtn" class="arBtn" slot="ar-button" disabled>
    Ver en AR
  </button>
</model-viewer>

<script>
  /* ... (mantén tu código de carga y el candado igual) ... */

  // ESTA PARTE ES NUEVA: Control de entrada/salida de AR
  mv.addEventListener('ar-status', (event) => {
    if (event.detail.status === 'session-started') {
      // Desactivamos el candado de la cámara web para que no interfiera con la AR
      lockActive = false;
    } else if (event.detail.status === 'not-presenting') {
      // Al volver a la web, reactivamos el candado y la vista estética
      lockActive = true;
      mv.cameraOrbit = `${LOCK_YAW}deg ${LOCK_PITCH}deg 2.2m`;
    }
  });
</script>
