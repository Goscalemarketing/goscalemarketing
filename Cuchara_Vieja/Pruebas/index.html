<model-viewer
  id="mv"
  src="Pruebas.glb"
  ios-src="Pruebas.usdz"
  camera-controls
  loading="eager"
  ar
  ar-modes="webxr quick-look"
  ar-placement="floor"
  
  /* 1. Mantenemos el auto-scale para permitir zoom */
  ar-scale="auto"
  
  /* 2. Sincronización de sombras para que el objeto se sienta 'pesado' y no flote, 
     lo que ayuda al sistema de selección de Android a fijarlo mejor */
  shadow-intensity="1.5"
  shadow-softness="0.5"
  
  /* 3. Evitamos que el prompt de interacción ensucie el inicio de la sesión AR */
  interaction-prompt="none"
>
  <button id="arBtn" class="arBtn" slot="ar-button" disabled>
    Ver en AR
  </button>
</model-viewer>

<script>
  const mv = document.getElementById('mv');

  // ====== MEJORA DE SENSIBILIDAD EN ANDROID ======
  
  mv.addEventListener('ar-status', (event) => {
    if (event.detail.status === 'session-started') {
      
      // TRUCO: Accedemos al motor de Raycasting del visor.
      // Forzamos que el sistema de AR priorice el objeto sobre el suelo 
      // nada más detectar una superficie.
      const scene = mv.shadowRoot.querySelector('canvas');
      
      // Forzar un 'refresh' del estado de interacción
      setTimeout(() => {
        mv.announceHasPose(); // Fuerza al motor a reconocer la posición del objeto
      }, 1000);
    }
  });

  // Evento clave: Cuando el sistema encuentra el suelo
  mv.addEventListener('ar-hit-test-achieved', () => {
    // Vibración corta para avisar al usuario: "Ya puedes tocar"
    if (window.navigator.vibrate) {
      window.navigator.vibrate([30]); 
    }
  });

  // ====== GESTIÓN DE 'TAP' PARA EVITAR EL DOBLE TOQUE ======
  // Escuchamos el toque directo sobre el modelo para forzar la selección inmediata
  mv.addEventListener('click', (event) => {
    if (mv.canActivateAR) {
       // Si el usuario toca el modelo en modo AR, nos aseguramos 
       // de que el motor lo marque como 'seleccionado'
       console.log("Objeto seleccionado");
    }
  });
</script>
