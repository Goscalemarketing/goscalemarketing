<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Go Scale · AR Premium</title>
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.1.1/model-viewer.min.js"></script>
  <style>
    html, body { margin:0; height:100%; background:#0b0b0b; font-family: system-ui, sans-serif; overflow:hidden; }
    
    /* Interfaz Web Normal */
    header { position:fixed; top:0; width:100%; height:56px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; background:rgba(15,15,15,.8); backdrop-filter:blur(10px); z-index:100; box-sizing:border-box; }
    .byGoscale img { height:22px; }
    
    main { height:100vh; display:flex; flex-direction:column; padding-top:56px; box-sizing:border-box; }
    .viewerWrap { flex:1; position:relative; }
    model-viewer { width:100%; height:100%; }

    /* --- CAPA DE CONTROLES AR (DOM OVERLAY) --- */
    /* Este ID es crítico para que WebXR lo reconozca */
    #ar-overlay {
      display: none; 
      width: 100%;
      height: 100%;
      pointer-events: none; /* Deja pasar los toques al 3D */
    }

    /* Contenedor de botones para que no se muevan al fijar el objeto */
    .controls-container {
      position: absolute;
      bottom: 60px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 12px;
      padding: 20px;
      pointer-events: none;
    }

    .btn-ar {
      pointer-events: auto; /* Permite pulsar los botones */
      background: rgba(0, 0, 0, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      width: 58px;
      height: 58px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }

    .btn-ar span:first-child { font-size: 20px; font-weight: bold; }
    .btn-ar span:last-child { font-size: 9px; text-transform: uppercase; font-weight: bold; }

    .ar-launch-btn { 
      position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
      padding:16px 30px; border-radius:30px; background:#fff; color:#000;
      font-weight:900; border:none; box-shadow:0 10px 20px rgba(0,0,0,0.5);
    }

    #loading { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:#0b0b0b; z-index:200; }
  </style>
</head>
<body>

<header>
  <div style="color:white; font-weight:bold;">← Menú</div>
  <div class="byGoscale"><img src="https://pub-83c24afb5cab45db860452e48428fdd5.r2.dev/assets/logo/goscalemarketing-logo.png"></div>
</header>

<main>
  <div class="viewerWrap">
    <div id="loading"><p style="color:white;">Cargando plato...</p></div>

    <model-viewer
      id="mv"
      src="Pruebas.glb" 
      ios-src="Pruebas.usdz"
      ar
      ar-modes="webxr quick-look"
      ar-placement="floor"
      camera-controls
      touch-action="none"
      shadow-intensity="1"
    >
      <button slot="ar-button" class="ar-launch-btn">VER EN TU MESA</button>

      <div id="ar-overlay">
        <div class="controls-container">
          <button class="btn-ar" id="rotBtn"><span>↻</span><span>Girar</span></button>
          <button class="btn-ar" id="zoomInBtn"><span>+</span><span>Zoom</span></button>
          <button class="btn-ar" id="zoomOutBtn"><span>−</span><span>Zoom</span></button>
          <button class="btn-ar" id="resetBtn"><span>⚓</span><span>Mover</span></button>
        </div>
      </div>
    </model-viewer>
  </div>
</main>

<script>
  const mv = document.getElementById('mv');
  const overlay = document.getElementById('ar-overlay');

  mv.addEventListener('load', () => {
    document.getElementById('loading').style.display = 'none';
  });

  // GESTIÓN DE VISIBILIDAD DE CONTROLES
  mv.addEventListener('ar-status', (event) => {
    if (event.detail.status === 'session-started') {
      overlay.style.display = 'block';
    } else {
      overlay.style.display = 'none';
    }
  });

  // Lógica de interacción
  let rotation = 0;
  let scale = 1;

  document.getElementById('rotBtn').onclick = () => {
    rotation += 45;
    mv.orientation = `0deg 0deg ${rotation}deg`;
  };

  document.getElementById('zoomInBtn').onclick = () => {
    scale += 0.2;
    mv.scale = `${scale} ${scale} ${scale}`;
  };

  document.getElementById('zoomOutBtn').onclick = () => {
    if (scale > 0.4) scale -= 0.2;
    mv.scale = `${scale} ${scale} ${scale}`;
  };

  // BOTÓN MOVER: Fuerza el reinicio del tracking
  document.getElementById('resetBtn').onclick = () => {
    if (window.navigator.vibrate) window.navigator.vibrate(40);
    
    // Al resetear el modo de placement, el sistema se ve obligado a 
    // soltar el anclaje actual y pedir al usuario que lo coloque de nuevo.
    mv.arPlacement = "wall"; 
    setTimeout(() => {
        mv.arPlacement = "floor";
        mv.requestUpdate();
    }, 50);
  };
</script>

</body>
</html>
